<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta de Equipos por Familia</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }
    .logo {
      display: block;
      margin: 0 auto 20px;
      max-width: 150px;
    }
    .selector-container {
      margin-bottom: 30px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    select {
      padding: 10px 15px;
      border-radius: 4px;
      border: 1px solid #ddd;
      font-size: 16px;
      flex-grow: 1;
    }
    button {
      padding: 10px 20px;
      background-color: #c62828;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #b71c1c;
    }
    .tabla-container {
      overflow-x: auto;
      margin-top: 20px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
      position: sticky;
      top: 0;
    }
    tr:hover {
      background-color: #f9f9f9;
    }
    .operativo {
      color: #2e7d32;
      font-weight: bold;
    }
    .inoperativo {
      color: #c62828;
      font-weight: bold;
    }
    .preventivo {
      color: #ff8f00;
      font-weight: bold;
    }
    .mantencion {
      color: #0277bd;
      font-weight: bold;
    }
    .contador {
      margin: 15px 0;
      font-weight: bold;
      color: #333;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://raw.githubusercontent.com/acciona-airport/Zarpes-acciona-aero/main/LogoAcciona2.png" alt="Logo Acciona" class="logo">
    <h1>Consulta de Equipos por Familia</h1>
    
    <div class="selector-container">
      <select id="select-familia">
        <option value="">-- Seleccione una familia --</option>
        <!-- Las opciones se llenarán con JavaScript -->
      </select>
      <button id="btn-buscar">Buscar</button>
    </div>
    
    <div id="contador" class="contador"></div>
    
    <div class="tabla-container">
      <table id="tabla-equipos">
        <thead>
          <tr>
            <th>ID</th>
            <th>Modelo</th>
            <th>Estado</th>
            <th>Observaciones</th>
          </tr>
        </thead>
        <tbody id="tabla-body">
          <!-- Los datos se llenarán aquí -->
        </tbody>
      </table>
      <div id="loading" class="loading">Seleccione una familia para ver los equipos</div>
    </div>
  </div>

  <script>
    // URL del Google Apps Script
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx5RL_GDtFwsKcMWyBYLwi2sdXtnkh9eXzdVs73jTS6zt3oAu9dmQwSeiyx43Tkt_QfeQ/exec";
    
    // Elementos del DOM
    const selectFamilia = document.getElementById('select-familia');
    const btnBuscar = document.getElementById('btn-buscar');
    const tablaBody = document.getElementById('tabla-body');
    const contador = document.getElementById('contador');
    const loading = document.getElementById('loading');
    
    // Lista de familias disponibles (se puede obtener dinámicamente si es necesario)
    const familias = [
      "ASU", "ACU", "Camión de baño", "Camión de agua", "Carro de baño", "Carro de agua",
      "Cargo Loader Lower deck", "Cargo Loader Main Deck", "GPU 90 KVA", "GPU 180 KVA",
      "TRACTOR AVIÓN", "TOWBARLESS", "Barra de Tiro", "EQUIPOS DE APOYO", "FURGON",
      "Conveyor", "Escala Motorizada", "Tractor Equipaje Elec", "Tractor Equipaje Diesel",
      "Escala Tractable", "Carro de deshielo", "Carro avih", "Carro techado", "Carro para Remoto"
    ];
    
    // Llenar el select con las familias
    familias.forEach(familia => {
      const option = document.createElement('option');
      option.value = familia;
      option.textContent = familia;
      selectFamilia.appendChild(option);
    });
    
    // Función para buscar equipos por familia
    async function buscarEquipos() {
      const familia = selectFamilia.value;
      
      if (!familia) {
        alert('Por favor seleccione una familia');
        return;
      }
      
      loading.textContent = 'Cargando equipos...';
      tablaBody.innerHTML = '';
      
      try {
        // Hacer la petición al Google Apps Script
        const response = await fetch(`${SCRIPT_URL}?tipo=familia&familia=${encodeURIComponent(familia)}`);
        const data = await response.json();
        
        if (data.error) {
          loading.textContent = data.error;
          contador.textContent = '';
          return;
        }
        
        mostrarResultados(data, familia);
      } catch (error) {
        console.error('Error al buscar equipos:', error);
        loading.textContent = 'Error al cargar los equipos';
        contador.textContent = '';
      }
    }
    
    // Función para mostrar los resultados en la tabla
    function mostrarResultados(equipos, familia) {
      if (equipos.length === 0) {
        loading.textContent = `No se encontraron equipos para la familia ${familia}`;
        contador.textContent = '';
        return;
      }
      
      loading.textContent = '';
      contador.textContent = `Mostrando ${equipos.length} equipos de la familia ${familia}`;
      
      // Ordenar equipos por ID
      equipos.sort((a, b) => a.ID.localeCompare(b.ID));
      
      // Llenar la tabla
      equipos.forEach(equipo => {
        const fila = document.createElement('tr');
        
        // Determinar la clase CSS según el estado
        let estadoClass = '';
        const estado = (equipo["STATUS ✎"] || '').toUpperCase();
        
        if (estado.includes('OPERATIVO')) estadoClass = 'operativo';
        else if (estado.includes('INOPERATIVO')) estadoClass = 'inoperativo';
        else if (estado.includes('PREVENTIVO')) estadoClass = 'preventivo';
        else if (estado.includes('MANTENCIÓN') || estado.includes('MANTENIMIENTO')) estadoClass = 'mantencion';
        
        fila.innerHTML = `
          <td>${equipo.ID || '-'}</td>
          <td>${equipo["MODELO EQUIPO"] || '-'}</td>
          <td class="${estadoClass}">${equipo["STATUS ✎"] || 'DESCONOCIDO'}</td>
          <td>${equipo.OBSERVACIONES || '-'}</td>
        `;
        
        tablaBody.appendChild(fila);
      });
    }
    
    // Event listeners
    btnBuscar.addEventListener('click', buscarEquipos);
    selectFamilia.addEventListener('change', function() {
      if (this.value) {
        buscarEquipos();
      }
    });
  </script>
</body>
</html>
